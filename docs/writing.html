<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Writing – Preston R. Johnston</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<link href="./MIT_logo.jpeg" rel="icon" type="image/jpeg">
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Preston R. Johnston</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./research.html"> 
<span class="menu-text">research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./cv.html"> 
<span class="menu-text">cv</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Writing</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>A mixture of essays and small, for-fun research projects on topics that interest me.</p>
<details>
<summary>
The existence of network effects is insufficient for causal explanation
</summary>
<section id="the-existence-of-network-effects-is-insufficient-for-causal-explanation" class="level1">
<h1>The existence of network effects is insufficient for causal explanation</h1>
<p><em>Originally published 9/10/2024</em></p>
<p>It has become fashionable lately in political science and economics to emphasize the role of social networks in explaining social phenomena. [examples!] The insight that “networks matter” is a basic and important one, and certainly coheres with our lived experiences of the world: We hear about new ideas, events, and behaviors from people in our networks—family, friends, coworkers, classmates. We may want to dress a certain way if our friends have started dressing that way, too. We may be more likely to vote for a candidate if we hear our colleagues discussing that candidate at work. But in this short essay, I want to make the simple point that networks themselves are not complete or satisfying causal explanations. As the adage goes, if one’s friends jumped off a cliff, one would (hopefully) have the wisdom to avoid following suit. My argument is that whenever it appears that a network explains some social, political, or economic outcome, there are several assumptions we should interrogate relating to the more fundamental causes of that outcome and the reasons the network is involved with the outcome’s spread or prevalence.</p>
<p>First, we should avoid confusing the way in which the network is a proximal cause for an idea or behavior (in that it spreads, amplifies, or legitimates it) with the original (or distal) cause of that idea or behavior. The network itself logically cannot be the distal cause of the outcome. Absent some originating force like an exogenous shock or social/political/cultural entrepreneur(s), the idea or behavior would not exist to propagate through the network. The idea or behavior must come from somewhere. It is often important (yet overlooked) to ask.</p>
<p>Second, there are also questions one should ask about the propagation of information through the network itself. What social structures, conditions, or individual attributes encourage this propagation? When node A shares information with node B (thereby forming an edge in the network), this relies on the existence of not only some communication channel between them, but a willingness from A to use it. A significant amount of network analysis research in the social sciences has focused heavily on the receipt of information and less on the incentives or conditions under which an individual shares that information. Does sharing that information or behavior provide esteem for the sender, or does the sender hope to change the behavior of the receiver for either selfish or altruistic reasons?</p>
<p>Third, if we observe individuals following behaviors only after their network demonstrated that behavior first, we should ask, why are these individuals susceptible to network influence? That is, what incentives or pressures do receivers have to adopt the behavior? There are many instances where individuals reject the candidate ideas or behaviors proffered by their networks. Agents endowed with reasoning skills, preferences, and experiences frequently assess whether the network’s behavior is rational from their perspective. Therefore, when an individual adopts an idea/behavior of their network, one or more of three things must be true: 1) the idea/behavior is utility-enhancing and preferable to alternatives (i.e., the individual has learned through the network); 2) the individual feels conscious or subconscious social pressure to adopt the idea/behavior, regardless of its merits; or 3) there are explicit coercive sanctions from the network to adopt the idea/behavior. In this context, we typically are less interested in behavior of category (3), which we don’t usually categorize as “network effects” but rather something like repression or private governance.</p>
<p>Fourth, and most fundamentally, why does the network exist at all, and why does it exist among these particular people? Many networks can be opted into (or opted out of). What about these individuals has brought them into the network, or kept them from leaving? We know from a rich literature in political economy and other subdisciplines on collective action that forming organizations is not straightforward. Networks are often (implicitly) contrasted with more formal organizations that involve costly behaviors such as homeowners’ associations, business groups, or social movements, but networks retain some similarities with these organizations. As mentioned above, sending information via networks does involve a cost to the sender (for example, time, breath, or effort, however small), and may also involve a cost to the receiver. It is usually not possible for an individual to opt out of all networks of which they are a member (true recluses are rare indeed), but it is usually possible to opt out of some networks, which individuals often do if the costs are too high. If a friend group has become hostile or exhausting, a person may quietly withdraw. If a family imposes strict traditional norms around religion or marriage, children may move away or disavow once they come of age. The point is this: networks of the sort typically referred to when we invoke “network analysis” in the social sciences require at least some degree of maintenance and consent, and these are themselves outcomes that must be explained. And crucially, the factors that cause an individual to join the network may also cause them to engage in the behavior reflected in the network. In other words, individual attributes are a confounder for both network membership and behavioral adoption. (A simple example is joining a club related to a hobby, and then adopting the behaviors or strategies from other members of the club—which one does precisely because they are interested in the hobby to begin with).</p>
<p>What do we lose when we bypass the four complexities outlined above and skip straight to the part where networks are a proximal cause for a given outcome? My contention is that network effects are often less interesting than 1) the distal cause of the outcome; 2) the use of channels to spread the outcome; 3) the individual assent or propensity to adopt the behavior; and 4) the existence of the network itself. To take an example, consider a recent paper by the economists Cutler and Donahoe, who study why the opioid epidemic has persisted for so long, despite the seeming thermostatic effects that would cause individuals and policymakers to avoid addiction or overdose. They place the blame for the ongoing epidemic squarely at the feet of social network spillovers: when one individual consumes an opioid, they may tell their friends and families about it, and/or share pills either in person or through online platforms such as Facebook. Cutler and Donahoe state in the paper’s abstract that “spillovers explain 84 to 92 percent of opioid deaths from 1990 to 2018 and are the main reason deaths have increased for so long.” Ignoring for now the complexities introduced later in the paper, let’s take the sentence in the abstract at face value. Is it really the case that spillovers themselves are the reason why people die from opioids? No, of course not. Why do some people want to take opioids to begin with, or put another way, what social conditions make them liable to experiment with opioids and vulnerable to addiction? Although individuals may proximally hear about drugs or acquire them from local contacts, this is not a satisfying explanation for why the epidemic started or persists. Going through the four points outlined above as they pertain to this example, I would tentatively argue that all four significantly qualify the blunt statement that “spillovers cause opioid deaths” and in some cases provide a more interesting or fruitful avenue for social investigation than the mere fact of network spread itself. Consider each point in turn: 1) Origin: The creation of OxyContin and Purdue’s false advertising of it as non-addictive; 2) Propagation: The somewhat surprising fact that people are willing and interested in sharing drugs via channels like Facebook; 3) Uptake: The fact that millions of people have pain, either physical or socioemotional, that make them inclined to abuse opioids (i.e., adopt the behavior of the network); 4) Network existence: The fact that there are social networks in opioid-ravaged areas of the United States that share drugs or information about drugs with each other, or that existing social ties become hijacked and converted into narcotic networks</p>
<p>Each of these points warrants explanation, as well as causal weighting (i.e., how relatively important is each in explaining the full picture of network-induced opioid addictions). In my view, spillovers themselves cannot provide a full causal explanation for a social outcome like the opioid epidemic. We need to understand the initial drivers, the incentives for propagation, the conditions for uptake, and the conditions for ongoing network existence and stability. When we incorporate these considerations, it becomes immediately clear that an explanation along the lines of Deaton and Case’s “deaths of despair” is needed (regardless of the truth of their particular argument). At least in the Deaton and Case account there is a plausible claim as to why people may want or need to take opioids, why social networks have been hijacked into being drug-sharing networks, and what policy prescriptions could exist that would address these background/distal causes rather than treating merely the proximal cause of network spillovers.</p>
</section></details>
<details>
<summary>
Do international soccer teams with co-national managers perform better?
</summary>

<section id="do-international-soccer-teams-with-co-national-managers-perform-better" class="level1">
<h1>Do international soccer teams with co-national managers perform better?</h1>
<p><em>Originally published 9/10/2024</em></p>
<p>This past summer, I watched many hours of the Euros and Copa America international soccer tournaments. Most top teams generally have managers (aka coaches) from the same country as the players (Didier Deschamps with France, Gareth Southgate with England), but not all (examples!). This got me wondering—do teams who hire coaches from another country perform better or worse than teams who hire coaches from the same country?</p>
<p>Soccer is a highly international sport, with players coming from virtually every continent. Liverpool FC, for example, my favorite club, regularly fields starting players from Egypt, Uruguay, Colombia, Argentina, the Netherlands, Scotland, France, and England. When players move teams, they’re often not just changing allegiances — they’re moving to a new country with a different language and culture. This poses a challenge from a team communication standpoint. Many foreign players take language classes, particularly in English, and some players may avoid media appearances for years, so as to not sound foolish giving an interview in their non-native tongue.</p>
<p>Contemporary soccer tactics are also fairly complex. Players need to know concepts such as “pressing triggers,” the difference between a regular and an “inverted” fullback, the difference between a single and “double pivot,” and so on. Managers attempt to stamp their tactical preferences on teams. When Arne Slot replaced Jurgen Klopp at Liverpool, the consensus was that he preferred a slightly–but not excessively–possession-based playstyle that valued quick, short passes and prioritized control in the center of the pitch rather than the wings. Again, not entirely straightforward concepts to explain even to native speakers! The communication challenge of soccer tactics is greatly exacerbated by the strictures of international football, where teams have much less time to train together, and whose rosters are composed of whoever is best in the country at a given position, leading to imbalances where some positions have a dearth of talent, or where some players prefer one playstyle, and other players prefer another. Is it easier to figure out a cohesive playstyle and get a team playing together when the coach is from the same country as the players? What about when the coach is from another country, but still natively speaks the same language?</p>
<p>surprised that no one has examined this with data</p>
<p>tested</p>
<p>control for ranks</p>
<p>1 month before</p>
<p>24 months before</p>
<p>conclusion</p>
</section></details>




</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>